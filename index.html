<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>$444 Blessings dApp</title>
    <style>
        body {
            background-color: #000000;
            /* Black background */
            color: #ffffff;
            /* White text */
            text-align: center;
            /* Center-align text */
            margin: 0;
            padding: 0;
            max-width: 940px;
            /* Limit maximum width */
            margin-left: auto;
            margin-right: auto;
        }

        header {
            text-align: left;
            padding: 10px;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        h1 {
            font-size: 24px;
            /* You can adjust the font size as needed */
        }

        p {
            font-size: 18px;
            /* You can adjust the font size as needed */
        }

        button {
            margin-top: 10px;
            /* Add margin as needed */
            font-size: 16px;
            /* You can adjust the font size as needed */
            background-color: #800080;
            /* Purple background */
            color: #ffffff;
            /* White text */
            padding: 10px 20px;
            /* Adjust padding as needed */
            border: none;
            border-radius: 5px;
            /* Add border radius for rounded corners */
            cursor: pointer;
            transition: background-color 0.3s ease;
            /* Add smooth transition effect */
        }

        button:hover {
            background-color: #600060;
            /* Darker purple on hover */
        }

        .stats {
            font-size: 14px;
        }

        .stats span {
            color: #00ff00;
            /* Green text */
        }

        .stats a {
            color: #ffffff;
            /* White text for links */
            text-decoration: none;
        }

        .stats a:hover {
            text-decoration: underline;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.3.6/dist/web3.min.js"></script>
</head>

<body>

    <header class="stats">
        <div>Blessing Faucet: <span style="color: #00ff00;">Active</span></div>
        <div>$444 Token Address: <a
                href="https://optimistic.etherscan.io/token/0x017557194713d864367e1f217cfbcf0470247b23"
                target="_blank">0x017557194713d864367e1f217cfbcf0470247b23</a></div>
        <div>Faucet Contract: <a href="https://optimistic.etherscan.io/token/0xBb0e398e2369fB1aBFAEd4a7d981eE71DF1586E2"
                target="_blank">0xBb0e398e2369fB1aBFAEd4a7d981eE71DF1586E2</a></div>
    </header>

    <div class="main-content">
        <h1>ðŸ”®</h1>
        <p id="account">Connect your wallet to claim blessings.</p>
        <button id="connectButton">Connect to Wallet</button>
        <button id="claimButton" style="display: none;">Claim Blessings</button>
        <button id="disconnectButton" style="display: none;">Disconnect Wallet</button>
    </div>


    <script>

        let web3;
        let blessingFaucetContract;
        let userAddress;

        let claimCooldown = 24 * 60 * 60; // 24 hours in seconds

        window.addEventListener('load', async () => {
            // Modern dapp browsers
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                try {
                    // Request account access if needed
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    // Accounts now exposed
                } catch (error) {
                    console.error('User denied account access');
                }
            }
            // Legacy dapp browsers
            else if (window.web3) {
                web3 = new Web3(web3.currentProvider);
            }
            // Non-dapp browsers
            else {
                console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');
                return;
            }

            // Initialize contract
            const contractAddress = '0xBb0e398e2369fB1aBFAEd4a7d981eE71DF1586E2';
            const contractAbi = [
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "_tokenAddress",
                            "type": "address"
                        }
                    ],
                    "stateMutability": "nonpayable",
                    "type": "constructor"
                },
                {
                    "anonymous": false,
                    "inputs": [
                        {
                            "indexed": false,
                            "internalType": "uint256",
                            "name": "newAmount",
                            "type": "uint256"
                        }
                    ],
                    "name": "BlessingAmountChanged",
                    "type": "event"
                },
                {
                    "anonymous": false,
                    "inputs": [
                        {
                            "indexed": true,
                            "internalType": "address",
                            "name": "user",
                            "type": "address"
                        },
                        {
                            "indexed": false,
                            "internalType": "uint256",
                            "name": "amount",
                            "type": "uint256"
                        }
                    ],
                    "name": "BlessingClaimed",
                    "type": "event"
                },
                {
                    "inputs": [],
                    "name": "admin",
                    "outputs": [
                        {
                            "internalType": "address",
                            "name": "",
                            "type": "address"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "blessingAmount",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "newAmount",
                            "type": "uint256"
                        }
                    ],
                    "name": "changeBlessingAmount",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "claimBlessing",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "amount",
                            "type": "uint256"
                        }
                    ],
                    "name": "deposit",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "",
                            "type": "address"
                        }
                    ],
                    "name": "lastBlessingTime",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "requiredTokenAddress",
                    "outputs": [
                        {
                            "internalType": "address",
                            "name": "",
                            "type": "address"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "tokenAddress",
                    "outputs": [
                        {
                            "internalType": "address",
                            "name": "",
                            "type": "address"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                }
            ];
            blessingFaucetContract = new web3.eth.Contract(contractAbi, contractAddress);

            // Connect button event listener
            const connectButton = document.getElementById('connectButton');
            connectButton.addEventListener('click', async () => {
                await connectWallet();
            });

            // Disconnect button event listener
            const disconnectButton = document.getElementById('disconnectButton');
            disconnectButton.addEventListener('click', async () => {
                await disconnectWallet();
            });

            // Claim button event listener
            const claimButton = document.getElementById('claimButton');
            claimButton.addEventListener('click', async () => {
                await claimBlessings();
            });

            // Check if a wallet is connected
            updateWalletConnection();

            // Set up periodic updates
            setInterval(() => {
                updateWalletConnection();
                updateClaimStatus();
            }, 1000);
        });

        // Function to update wallet connection status
        async function updateWalletConnection() {
            const accounts = await web3.eth.getAccounts();
            if (accounts.length > 0) {
                userAddress = accounts[0];
                document.getElementById('account').textContent = `Connected with address: ${userAddress}`;
                document.getElementById('connectButton').style.display = 'none';
                document.getElementById('disconnectButton').style.display = 'block';
                document.getElementById('claimButton').style.display = 'block';
                updateClaimStatus();
                updateTotalBlessings();
            } else {
                document.getElementById('account').textContent = 'Connect your wallet to claim blessings.';
                document.getElementById('connectButton').style.display = 'block';
                document.getElementById('disconnectButton').style.display = 'none';
                document.getElementById('claimButton').style.display = 'none';
                resetClaimStatus();
            }
        }

        // Function to connect the wallet
        async function connectWallet() {
            try {
                // Request account access if needed
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                // Update wallet connection status
                updateWalletConnection();
            } catch (error) {
                console.error('User denied account access');
            }
        }

        // Function to disconnect the wallet
        async function disconnectWallet() {
            // Disconnecting is just refreshing the page in this example
            window.location.reload();
        }

        // Function to claim blessings
        async function claimBlessings() {
            try {
                // Call the claimBlessing function in the contract
                await blessingFaucetContract.methods.claimBlessing().send({ from: userAddress });
                // Update wallet connection status
                updateWalletConnection();
            } catch (error) {
                console.error('Error claiming blessings:', error);
            }
        }

        // Function to update the countdown and claim status
        function updateClaimStatus() {
            const currentTime = Math.floor(Date.now() / 1000);
            const lastClaimTime = localStorage.getItem('lastClaimTime') || 0;
            const timeUntilClaim = Math.max(0, lastClaimTime + claimCooldown - currentTime);

            const countdownValue = formatTime(timeUntilClaim);
            document.getElementById('countdownValue').textContent = countdownValue;

            const claimStatusElement = document.getElementById('claimStatus');
            if (timeUntilClaim === 0) {
                claimStatusElement.textContent = 'You can claim blessings now!';
                claimStatusElement.style.color = 'green';
            } else {
                claimStatusElement.textContent = 'Claim not eligible yet.';
                claimStatusElement.style.color = 'red';
            }
        }

        // Function to update the total blessings claimed
        async function updateTotalBlessings() {
            const totalBlessings = await blessingFaucetContract.methods.totalBlessings().call();
            document.getElementById('totalBlessingsValue').textContent = totalBlessings.toString();
        }

        // Function to reset claim status when wallet is disconnected
        function resetClaimStatus() {
            document.getElementById('countdownValue').textContent = '';
            document.getElementById('claimStatus').textContent = '';
        }

        // Helper function to format time in HH:MM:SS
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const remainingSeconds = seconds % 60;
            return `${pad(hours)}:${pad(minutes)}:${pad(remainingSeconds)}`;
        }

        // Helper function to pad single-digit numbers with a leading zero
        function pad(number) {
            return number < 10 ? `0${number}` : `${number}`;
        }
    </script>
</body>

</html>
